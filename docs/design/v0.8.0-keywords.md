# DOL v0.8.0 - Keyword Changes Design Document

**Status**: Draft
**Version**: 0.8.0
**Author**: Syntax Architecture Team
**Date**: 2026-01-16

## Executive Summary

DOL v0.8.0 introduces streamlined keyword changes to improve clarity, reduce verbosity, and establish neutral, inclusive terminology. This document specifies the keyword transformations and provides migration guidance.

---

## 1. Keyword Transformation Table

| Current (v0.7.x) | New (v0.8.0) | Rationale | Breaking |
|------------------|--------------|-----------|----------|
| `gene` | `gen` | Neutral terminology, concise, genesis unit | Yes |
| `trait` | `trait` | No change (Rust alignment) | No |
| `constraint` | `rule` | Clearer intent, shorter, familiar | Yes |
| `evolves` | `evo` | Concise versioning, reduces verbosity | Yes |
| `exegesis` | `docs` | Familiar, clear, industry standard | Yes |

---

## 2. Detailed Keyword Specifications

### 2.1 `gene` → `gen`

**Current Syntax (v0.7.x):**
```dol
gene container.exists {
  container has identity
  container has state
}

exegesis {
  A container is the fundamental unit of workload isolation.
}
```

**New Syntax (v0.8.0):**
```dol
gen container.exists {
  container has identity
  container has state
}

docs {
  A container is the fundamental unit of workload isolation.
}
```

**Rationale:**
- **Neutral terminology**: Removes biological metaphor, adopts "genesis" interpretation
- **Concise**: 3 characters vs 4 (25% reduction)
- **Clear intent**: "gen" suggests generation/genesis of atomic units
- **Pronunciation**: Maintains phonetic clarity (/dʒɛn/)

**Impact:**
- All `gene` declarations must be renamed to `gen`
- AST node changes: `Declaration::Gene` → `Declaration::Gen`
- TokenKind changes: `TokenKind::Gene` → `TokenKind::Gen`

---

### 2.2 `trait` → `trait` (No Change)

**Rationale:**
- Already aligns with Rust terminology
- Well-understood in type systems
- Industry standard for composable behaviors
- No migration burden

**Status**: UNCHANGED

---

### 2.3 `constraint` → `rule`

**Current Syntax (v0.7.x):**
```dol
constraint container.integrity {
  container state matches declared state
  container identity never changes
}

exegesis {
  Container integrity ensures runtime matches declared ontology.
}
```

**New Syntax (v0.8.0):**
```dol
rule container.integrity {
  container state matches declared state
  container identity never changes
}

docs {
  Container integrity ensures runtime matches declared ontology.
}
```

**Rationale:**
- **Clearer intent**: "rule" directly communicates invariant enforcement
- **Shorter**: 4 characters vs 10 (60% reduction)
- **Familiar**: Widely used in business logic, validation frameworks
- **Semantic precision**: Emphasizes prescriptive nature

**Impact:**
- All `constraint` declarations must be renamed to `rule`
- AST node changes: `Declaration::Constraint` → `Declaration::Rule`
- TokenKind changes: `TokenKind::Constraint` → `TokenKind::Rule`

---

### 2.4 `evolves` → `evo`

**Current Syntax (v0.7.x):**
```dol
evolves container.lifecycle @ 0.0.2 > 0.0.1 {
  adds container is paused
  adds container is resumed

  because "workload migration requires state preservation"
}

exegesis {
  Version 0.0.2 extends the lifecycle for migration support.
}
```

**New Syntax (v0.8.0):**
```dol
evo container.lifecycle @ 0.0.2 > 0.0.1 {
  adds container is paused
  adds container is resumed

  because "workload migration requires state preservation"
}

docs {
  Version 0.0.2 extends the lifecycle for migration support.
}
```

**Rationale:**
- **Concise versioning**: 3 characters vs 7 (57% reduction)
- **Semantic clarity**: Directly evokes "evolution" with minimal verbosity
- **Reduces file length**: Critical for lineage files with many versions
- **Maintains readability**: "evo" is unambiguous in context

**Impact:**
- All `evolves` declarations must be renamed to `evo`
- AST node changes: `Declaration::Evolution` → `Declaration::Evo`
- TokenKind changes: `TokenKind::Evolves` → `TokenKind::Evo`

---

### 2.5 `exegesis` → `docs`

**Current Syntax (v0.7.x):**
```dol
gene container.exists {
  container has identity
}

exegesis {
  A container is the fundamental unit.
}
```

**New Syntax (v0.8.0):**
```dol
gen container.exists {
  container has identity
}

docs {
  A container is the fundamental unit.
}
```

**Rationale:**
- **Familiar terminology**: "docs" is universally understood
- **Shorter**: 4 characters vs 8 (50% reduction)
- **Clear purpose**: Immediately communicates documentation intent
- **Industry standard**: Aligns with JSDoc, rustdoc, etc.
- **Removes obscurity**: "exegesis" is unfamiliar to many developers

**Impact:**
- All `exegesis` blocks must be renamed to `docs`
- AST field changes: `exegesis: String` → `docs: String`
- TokenKind changes: `TokenKind::Exegesis` → `TokenKind::Docs`

---

## 3. AST Changes

### 3.1 TokenKind Enum Updates

**src/lexer.rs** (lines 82-94):

```rust
// BEFORE (v0.7.x)
pub enum TokenKind {
    // === Declaration Keywords ===
    Gene,
    Trait,
    Constraint,
    System,
    Evolves,
    Exegesis,
    // ...
}

// AFTER (v0.8.0)
pub enum TokenKind {
    // === Declaration Keywords ===
    Gen,        // Changed from Gene
    Trait,      // Unchanged
    Rule,       // Changed from Constraint
    System,     // Unchanged
    Evo,        // Changed from Evolves
    Docs,       // Changed from Exegesis
    // ...
}
```

### 3.2 Declaration Enum Updates

**src/ast.rs** (lines 260-284):

```rust
// BEFORE (v0.7.x)
pub enum Declaration {
    Gene(Gene),
    Trait(Trait),
    Constraint(Constraint),
    System(System),
    Evolution(Evolution),
    // ...
}

// AFTER (v0.8.0)
pub enum Declaration {
    Gen(Gen),               // Changed from Gene
    Trait(Trait),           // Unchanged
    Rule(Rule),             // Changed from Constraint
    System(System),         // Unchanged
    Evo(Evo),              // Changed from Evolution
    // ...
}
```

### 3.3 Struct Name Changes

```rust
// BEFORE
pub struct Gene { /* ... */ }
pub struct Constraint { /* ... */ }
pub struct Evolution { /* ... */ }

// AFTER
pub struct Gen { /* ... */ }
pub struct Rule { /* ... */ }
pub struct Evo { /* ... */ }
```

### 3.4 Field Name Changes

All structs with `exegesis: String` field:

```rust
// BEFORE
pub struct Gen {
    pub name: String,
    pub statements: Vec<Statement>,
    pub exegesis: String,  // ← Change this
    pub span: Span,
}

// AFTER
pub struct Gen {
    pub name: String,
    pub statements: Vec<Statement>,
    pub docs: String,      // ← Changed
    pub span: Span,
}
```

Affected structs:
- `Gen` (formerly `Gene`)
- `Trait`
- `Rule` (formerly `Constraint`)
- `System`
- `Evo` (formerly `Evolution`)
- `FunctionDecl`
- `LawDecl` (optional field)

---

## 4. Lexer Changes

### 4.1 Keyword Recognition

**src/lexer.rs** `keyword_kind()` method (lines 1186-1279):

```rust
fn keyword_kind(&self, lexeme: &str) -> Option<TokenKind> {
    match lexeme {
        // v0.8.0 keywords
        "gen" => Some(TokenKind::Gen),           // Changed from "gene"
        "trait" => Some(TokenKind::Trait),       // Unchanged
        "rule" => Some(TokenKind::Rule),         // Changed from "constraint"
        "system" => Some(TokenKind::System),
        "evo" => Some(TokenKind::Evo),          // Changed from "evolves"
        "docs" => Some(TokenKind::Docs),        // Changed from "exegesis"
        // ...
        _ => None,
    }
}
```

### 4.2 Display Implementation

**src/lexer.rs** `Display for TokenKind` (lines 497-648):

```rust
impl std::fmt::Display for TokenKind {
    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {
        match self {
            TokenKind::Gen => write!(f, "gen"),
            TokenKind::Trait => write!(f, "trait"),
            TokenKind::Rule => write!(f, "rule"),
            TokenKind::System => write!(f, "system"),
            TokenKind::Evo => write!(f, "evo"),
            TokenKind::Docs => write!(f, "docs"),
            // ...
        }
    }
}
```

---

## 5. Migration Strategy

### 5.1 Automated Migration Tool

Create `dol-migrate-0.8` CLI tool:

```bash
# Migrate single file
dol-migrate-0.8 examples/genes/container.exists.dol

# Migrate directory (recursive)
dol-migrate-0.8 --recursive examples/

# Dry run (show changes without applying)
dol-migrate-0.8 --dry-run examples/
```

**Transformation Rules:**
1. Replace `gene ` → `gen ` (with trailing space)
2. Replace `constraint ` → `rule ` (with trailing space)
3. Replace `evolves ` → `evo ` (with trailing space)
4. Replace `exegesis {` → `docs {`
5. Update documentation references

### 5.2 Backward Compatibility

**Deprecation Period**: v0.7.x will continue to accept old keywords with warnings:

```
warning: keyword 'gene' is deprecated, use 'gen' instead
  --> examples/genes/container.exists.dol:1:1
   |
 1 | gene container.exists {
   | ^^^^ help: replace with 'gen'
```

**Timeline:**
- v0.7.x: Old keywords supported (no warnings)
- v0.8.0: Old keywords supported with deprecation warnings
- v0.9.0: Old keywords removed (breaking change)

### 5.3 Migration Checklist

For each .dol file:
- [ ] Replace `gene` with `gen`
- [ ] Replace `constraint` with `rule`
- [ ] Replace `evolves` with `evo`
- [ ] Replace `exegesis` with `docs`
- [ ] Update inline comments referencing old keywords
- [ ] Update documentation/README files
- [ ] Run `cargo test` to verify changes
- [ ] Run `dol-check` to validate all declarations

---

## 6. Testing Requirements

### 6.1 Lexer Tests

Update all lexer tests to use new keywords:

```rust
#[test]
fn test_keywords_v08() {
    let mut lexer = Lexer::new("gen trait rule");
    assert_eq!(lexer.next_token().kind, TokenKind::Gen);
    assert_eq!(lexer.next_token().kind, TokenKind::Trait);
    assert_eq!(lexer.next_token().kind, TokenKind::Rule);
}

#[test]
fn test_evo_keyword() {
    let mut lexer = Lexer::new("evo container.lifecycle @ 0.0.2 > 0.0.1");
    assert_eq!(lexer.next_token().kind, TokenKind::Evo);
}

#[test]
fn test_docs_keyword() {
    let mut lexer = Lexer::new("docs { documentation }");
    assert_eq!(lexer.next_token().kind, TokenKind::Docs);
}
```

### 6.2 Parser Tests

Update parser tests to expect new keywords and AST nodes:

```rust
#[test]
fn test_parse_gen_declaration() {
    let input = r#"
    gen container.exists {
      container has identity
    }

    docs {
      A container is the fundamental unit.
    }
    "#;

    let mut parser = Parser::new(input);
    let decl = parser.parse_declaration().unwrap();

    match decl {
        Declaration::Gen(gen) => {
            assert_eq!(gen.name, "container.exists");
            assert_eq!(gen.docs, "A container is the fundamental unit.");
        }
        _ => panic!("Expected Gen declaration"),
    }
}
```

### 6.3 Integration Tests

Create comprehensive integration tests:

```rust
#[test]
fn test_all_v08_keywords() {
    let input = r#"
    gen container.exists {
      container has identity
    }

    docs { Container genesis. }

    trait container.lifecycle {
      uses container.exists
    }

    docs { Container lifecycle. }

    rule container.integrity {
      container state matches declared state
    }

    docs { Container integrity rule. }

    evo container.lifecycle @ 0.0.2 > 0.0.1 {
      adds container is paused
    }

    docs { Evolution to v0.0.2. }
    "#;

    let mut parser = Parser::new(input);
    // Parse all declarations and verify structure
}
```

---

## 7. Documentation Updates

All documentation must be updated:

### 7.1 Files to Update
- [ ] README.md - Replace all keyword references
- [ ] docs/specification.md - Update language specification
- [ ] docs/grammar.ebnf - Update formal grammar
- [ ] docs/tutorials/ - Update all examples
- [ ] examples/ - Migrate all .dol files
- [ ] CHANGELOG.md - Document breaking changes

### 7.2 Example Update

**Before (v0.7.x):**
```markdown
# DOL Language Reference

Declarations in DOL:
- `gene` - Atomic ontological units
- `constraint` - System invariants
- `evolves` - Version evolution
```

**After (v0.8.0):**
```markdown
# DOL Language Reference

Declarations in DOL:
- `gen` - Genesis units (atomic ontological units)
- `rule` - System invariants and rules
- `evo` - Evolution tracking (version lineage)
```

---

## 8. Error Messages

Update all error messages to use new terminology:

**Before:**
```
error: expected 'gene', 'trait', or 'constraint'
  --> file.dol:1:1
```

**After:**
```
error: expected 'gen', 'trait', or 'rule'
  --> file.dol:1:1
```

---

## 9. Compiler Flags

Add compiler flag for migration assistance:

```bash
# Enable v0.7.x compatibility mode (warnings for deprecated keywords)
dolc --compat-v07 file.dol

# Strict v0.8.0 mode (errors for old keywords)
dolc --strict file.dol
```

---

## 10. Release Notes Template

```markdown
# DOL v0.8.0 Release Notes

## Breaking Changes

### Keyword Changes

DOL v0.8.0 introduces streamlined keyword syntax:

| Old Keyword | New Keyword | Migration |
|-------------|-------------|-----------|
| `gene` | `gen` | Automatic via `dol-migrate-0.8` |
| `constraint` | `rule` | Automatic via `dol-migrate-0.8` |
| `evolves` | `evo` | Automatic via `dol-migrate-0.8` |
| `exegesis` | `docs` | Automatic via `dol-migrate-0.8` |

**Migration Guide**: Run `dol-migrate-0.8 --recursive .` on your project.

**Rationale**: These changes improve clarity, reduce verbosity, and adopt
neutral, inclusive terminology.
```

---

## 11. Implementation Checklist

- [ ] Update TokenKind enum in src/lexer.rs
- [ ] Update keyword_kind() method in src/lexer.rs
- [ ] Update Display implementation for TokenKind
- [ ] Update Declaration enum in src/ast.rs
- [ ] Rename Gene → Gen struct
- [ ] Rename Constraint → Rule struct
- [ ] Rename Evolution → Evo struct
- [ ] Rename all exegesis fields → docs
- [ ] Update all lexer tests
- [ ] Update all parser tests
- [ ] Update integration tests
- [ ] Create migration tool (dol-migrate-0.8)
- [ ] Update documentation
- [ ] Update examples/
- [ ] Update error messages
- [ ] Add compiler compatibility flags
- [ ] Update CHANGELOG.md
- [ ] Create migration guide

---

## 12. Success Criteria

- [ ] All tests pass with new keywords
- [ ] Migration tool successfully converts all examples/
- [ ] No regressions in parser functionality
- [ ] Documentation fully updated
- [ ] Backward compatibility warnings implemented
- [ ] Release notes published

---

**Document Version**: 1.0
**Last Updated**: 2026-01-16
**Next Review**: v0.9.0 planning
