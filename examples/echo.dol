// Echo Spirit - Messaging example
// send/recv effects inferred automatically

gen EchoSpirit {
    has messages_handled: Int

    fun tick() {
        if pending() > 0 {
            let msg = recv()
            let sender_id = sender()

            println("Echo received: " + msg)
            send(sender_id, msg)

            this.messages_handled = this.messages_handled + 1
        }
    }
}
