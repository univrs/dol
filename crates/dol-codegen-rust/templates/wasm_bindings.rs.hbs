{{! Handlebars template for WASM bindings }}
//! WASM bindings for {{struct_name}}
//! Generated by DOL Automerge Codegen

use wasm_bindgen::prelude::*;
use automerge::Automerge;

/// WASM wrapper for {{struct_name}}
#[wasm_bindgen]
pub struct {{wasm_name}} {
    inner: {{struct_name}},
    doc: Automerge,
}

#[wasm_bindgen]
impl {{wasm_name}} {
    /// Create a new instance
    #[wasm_bindgen(constructor)]
    pub fn new() -> Self {
        Self {
            inner: {{struct_name}}::default(),
            doc: Automerge::new(),
        }
    }

{{#each fields}}
    /// Get {{field_name}}
    #[wasm_bindgen]
    pub fn get_{{field_name}}(&self) -> {{#if is_copy}}{{field_type}}{{else}}JsValue{{/if}} {
        {{#if is_copy}}
        self.inner.{{field_name}}
        {{else}}
        serde_wasm_bindgen::to_value(&self.inner.{{field_name}})
            .unwrap_or(JsValue::NULL)
        {{/if}}
    }

    /// Set {{field_name}}
    #[wasm_bindgen]
    pub fn set_{{field_name}}(&mut self, value: {{#if is_copy}}{{field_type}}{{else}}JsValue{{/if}}) {{#unless is_copy}}-> Result<(), JsValue> {{/unless}}{
        {{#if is_copy}}
        self.inner.{{field_name}} = value;
        {{else}}
        let parsed: {{field_type}} = serde_wasm_bindgen::from_value(value)
            .map_err(|e| JsValue::from_str(&e.to_string()))?;
        self.inner.{{field_name}} = parsed;
        Ok(())
        {{/if}}
    }

{{/each}}
    /// Merge changes from another instance
    #[wasm_bindgen]
    pub fn merge(&mut self, other: &{{wasm_name}}) -> Result<(), JsValue> {
        self.inner
            .merge(&other.inner)
            .map_err(|e| JsValue::from_str(&e.to_string()))
    }

    /// Save to Automerge binary format
    #[wasm_bindgen]
    pub fn save(&self) -> Result<Vec<u8>, JsValue> {
        self.doc
            .save()
            .map_err(|e| JsValue::from_str(&e.to_string()))
    }

    /// Load from Automerge binary format
    #[wasm_bindgen]
    pub fn load(bytes: &[u8]) -> Result<{{wasm_name}}, JsValue> {
        let doc = Automerge::load(bytes)
            .map_err(|e| JsValue::from_str(&e.to_string()))?;
        let inner = {{struct_name}}::from_automerge(&doc)
            .map_err(|e| JsValue::from_str(&e.to_string()))?;
        Ok(Self { inner, doc })
    }

    /// Convert to JSON for debugging
    #[wasm_bindgen]
    pub fn to_json(&self) -> Result<String, JsValue> {
        serde_json::to_string(&self.inner)
            .map_err(|e| JsValue::from_str(&e.to_string()))
    }
}
