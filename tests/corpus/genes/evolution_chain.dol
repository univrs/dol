module tests.evolution_chain @ 1.0.0

// Base type
pub gen EntityV1 {
    has id: u32
    has name: string
}

// First evo - add fields
evo EntityV1 > EntityV2 @ 2.0.0 {
    added created_at: i64 = 0
    added updated_at: i64 = 0

    migrate from EntityV1 {
        return EntityV2 {
            ...old,
            created_at: 0,
            updated_at: 0
        }
    }
}

// Second evo - change types
evo EntityV2 > EntityV3 @ 3.0.0 {
    changed id: u32 -> u64
    added metadata: Map<string, string>
    removed updated_at

    migrate from EntityV2 {
        return EntityV3 {
            id: old.id as u64,
            name: old.name,
            created_at: old.created_at,
            metadata: Map.new()
        }
    }
}

// Third evo - rename fields
evo EntityV3 > EntityV4 @ 4.0.0 {
    renamed name -> display_name
    added tags: Vec<string> = []

    migrate from EntityV3 {
        return EntityV4 {
            id: old.id,
            display_name: old.name,
            created_at: old.created_at,
            metadata: old.metadata,
            tags: []
        }
    }
}

// Geological time evo (biology-style)
pub gen Prokaryote {
    has dna_length: u64
    has cell_wall: bool = true
}

evo Prokaryote > Eukaryote @ 2.0Gya {
    added nucleus: bool = true
    added mitochondria: u64 = 1
    added cell_size: f64 = 10.0

    migrate from Prokaryote {
        return Eukaryote {
            ...old,
            nucleus: true,
            mitochondria: 1,
            cell_size: 10.0
        }
    }

    docs {
        Endosymbiotic origin of eukaryotes, ~2 billion years ago.
    }
}

evo Eukaryote > Multicellular @ 600Mya {
    added cell_count: u64 = 2
    added differentiation: bool = false

    migrate from Eukaryote {
        return Multicellular {
            ...old,
            cell_count: 2,
            differentiation: false
        }
    }
}

docs {
    Tests for evo chains with various change types.
}
